<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="./static/css/base.css" rel="stylesheet">
    <link href="./static/css/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet"
        type="text/css">
    <title> {{ YEAR }} å¹´åº¦æ€»ç»“! </title>
    <style>
        .font-sans {
            font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
        }

        .font-serif {
            font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
        }

        .text-red-700 {
            color: #b91c1c;
        }

        .bg-yellow-200 {
            background-color: #fef08a;
        }

        .font-bold {
            font-weight: bold;
        }

        .px-1 {
            padding-left: 0.25rem;
            padding-right: 0.25rem;
        }

        #animated-text {
            white-space: pre-wrap;
            display: inline-block;
        }

        .animated-image {
            opacity: 0;
            transform: scale(0.5);
            transition: transform 1s ease-in-out, opacity 1s ease-in-out;
        }

        .animate-on-show {
            opacity: 1;
            transform: scale(1);
        }
    </style>

    <link rel="stylesheet" href="./static/reveal/reveal.css">
    <link rel="stylesheet" href="./static/reveal/theme/simple.css" id="theme">
    <link rel="stylesheet" href="./static/jyy/jyy.css">
    <style type="text/css">
        /* ç”¨æ¥æ§åˆ¶æ‰‡å½¢å›¾çš„ */
        #canvas-holder {
            background-color: #FFFFFF;
            height: 50%;
            width: 50%;
        }
    </style>
</head>

<body class="d-flex flex-column h-100">

    <div class="reveal">
        <div class="slides">
            <section>
                <div class="center middle">
                    <div style="width:100%">
                        <div>
                            <h2 id="_1" class="text-2xl mt-2 font-sans">ä½ çš„{{ YEAR }}å¹´æµè§ˆè®°å½•å¹´åº¦æ€»ç»“ğŸš€</h2>
                        </div>
                    </div>
                </div>
            </section>
            <section>
                <audio id="typing-sound" src="./static/sound/keyboard-typing-5997.mp3" preload="auto"></audio>
                <h2 id="animated-text" class="text-2xl mt-2 font-sans"></h2>
            </section>
            <section>
                <div class="center middle">
                    <div style="width:100%">
                        <h2 class="text-2xl mt-2 font-sans">ä½ çš„å¹´åº¦å…³é”®è¯ç«Ÿæ˜¯ğŸ§</h2>
                        <center>
                            <img src="./wordcloud.png" alt="wordcloud" class="animated-image" />
                        </center>
                    </div>
                </div>
            </section>
            <section>
                <h2 class="text-2xl mt-2 font-sans">ä½ æœ€å¸¸è®¿é—®çš„åŸŸåğŸ”—</h2>
                <div style="width:100%">
                    <canvas id="Chart_domains"></canvas>
                </div>
            </section>
            <section>
                <h2 class="text-2xl mt-2 font-sans">â€œä¸å¤ªå‡†â€çš„ç±»å‹å æ¯”ğŸ“ˆ</h2>
                <div style="width:100%">
                    <center>
                        <div id="canvas-holder">
                            <canvas id="Chart_category"></canvas>
                        </div>
                    </center>
                </div>
            </section>
            <section>
                <h2 class="text-2xl mt-2 font-sans">ä½ çš„æ¯æœˆè®¿é—®é‡ğŸ“Š</h2>
                <div style="width:100%">
                    <canvas id="Chart_months"></canvas>
                </div>
            </section>
            <section>
                <h2 class="text-2xl mt-2 font-sans">ä½ æ›´çˆ±åœ¨è¿™äº›æ—¶é—´æ®µä¸Šç½‘ğŸ•’</h2>
                <div style="display: flex; justify-content: space-between;">
                    <div style="width: 45%; text-align: center;">
                        <canvas id="Chart_first_half"></canvas>
                    </div>
                    <div style="width: 48%; text-align: center;">
                        <canvas id="Chart_second_half"></canvas>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script src="./static/reveal/reveal.js"></script>

    <script>
        Reveal.initialize({
            width: 1024, height: 768,
            slideNumber: false,
            controlsTutorial: false,
            progress: false,
            hash: true,
            center: false,
            touch: true,
            autoAnimateUnmatched: true,
            autoAnimateEasing: 'ease-out',
            autoAnimateDuration: 1.0,
            transitionSpeed: 'default',
            transition: 'slide', // zoom
        });
    </script>

    <script src="./static/css/chart.js"></script>

    <script>
        const over_view_content = [
            { text: "åœ¨", highlight: false },
            { text: "{{ YEAR }}", highlight: true },
            { text: "å¹´, ä½ å…±è®¡æµè§ˆè¿‡", highlight: false },
            { text: "{{ DAYS }}", highlight: true },
            { text: "å¤©, ç‚¹å‡»äº†", highlight: false },
            { text: "{{ COUNT }}", highlight: true },
            { text: "æ¬¡é“¾æ¥, å¹³å‡æ¯å¤©ç‚¹å‡»", highlight: false },
            { text: "{{ AVG }}", highlight: true },
            { text: "æ¬¡.", highlight: false },
            { text: "\n\n", highlight: false },
            { text: "{{ LONGEST_DAY }}, ä½ ç«Ÿç„¶è®¿é—®äº†è¶³è¶³", highlight: false },
            { text: "{{ LONGEST_DAY_TIME }}", highlight: true },
            { text: "å°æ—¶æµè§ˆå™¨, ä½ çœŸæ˜¯å¤ªå‰å®³äº†!\n\n", highlight: false },
            { text: "{{ LATEST_SLEEP_DAY }}, ä½ åœ¨", highlight: false },
            { text: "{{ LATEST_SLEEP_TIME }}", highlight: true },
            { text: "è¿˜æœªå…¥çœ , é™ªä¼´ä½ çš„æ˜¯ {{ LATEST_SLEEP_TITLE }}\n", highlight: false },
            { text: "ä½ æœ€æ—©åœ¨ {{ EARLIEST_WAKE_DAY }}", highlight: false },
            { text: "{{ EARLIEST_WAKE_TIME }}", highlight: true },
            { text: "é†’æ¥, ç¬¬ä¸€ä¸ªè®¿é—®çš„ {{ EARLIEST_WAKE_TITLE }}", highlight: false },
        ];
        const container = document.getElementById("animated-text");
        const typingSound = document.getElementById("typing-sound"); // è·å–éŸ³é¢‘å…ƒç´ 
        typingSound.currentTime = 0; // é‡ç½®éŸ³é¢‘åˆ°å¼€å§‹ä½ç½®
        let index = 0;
        const allCharacters = over_view_content.flatMap(item =>
            item.text.split("").map(char => ({ char, highlight: item.highlight }))
        );
        function typeOverViewText() {
            if (index < allCharacters.length) {
                const span = document.createElement("span");
                const text = allCharacters[index].char;
                // æ£€æŸ¥æ˜¯å¦åŒ…å«æ¢è¡Œç¬¦
                if (text === '\n') {
                    const br = document.createElement("br");
                    container.appendChild(br);  // æ¢è¡Œ
                } else {
                    span.textContent = text;
                    if (allCharacters[index].highlight) {
                        span.className = "text-red-700 bg-yellow-200 font-bold px-1";
                    }
                    container.appendChild(span);
                }

                // æ’­æ”¾æ‰“å­—æœºéŸ³æ•ˆ
                typingSound.play();
                index++;
                setTimeout(typeOverViewText, 100);
            } else {
                typingSound.pause();
            }
        }

        // charts
        const result = {{ OUTPUTJSON }};

        // chart months
        const months_data = result['æ¯æœˆè®¿é—®é‡'];
        const config_months = {
            type: 'line',
            data: {
                labels: months_data['æœˆä»½'],
                datasets: [{
                    data: months_data['è®¿é—®æ¬¡æ•°'],
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                }]
            },
            options: {
                animations: {
                    tension: {
                        duration: 1000,
                        easing: 'linear',
                        from: 1,
                        to: 0,
                        loop: true
                    }
                },
                plugins: {
                    legend: {
                        display: false // éšè—å›¾ä¾‹
                    },
                }
            }
        };
        new Chart(document.getElementById('Chart_months'), config_months);

        // chart domains
        const domainData = result["æœ€å¸¸è®¿é—®çš„åŸŸå"];
        const labels = Object.keys(domainData); // åŸŸå
        const values = Object.values(domainData); // è®¿é—®æ¬¡æ•°

        const data = {
            labels: labels,
            datasets: [{
                label: 'è®¿é—®æ¬¡æ•°',
                data: values,
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        };

        const config_domains = {
            type: 'bar',
            data: data,
            options: {
                indexAxis: 'y',
                animation: {
                    duration: 1500, // åŠ¨ç”»æŒç»­æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰
                    easing: 'easeOutBounce', // åŠ¨ç”»ç¼“åŠ¨æ•ˆæœ
                    onComplete: () => {
                    }
                },
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: true
                    }
                },
            }
        };
        new Chart(document.getElementById('Chart_domains'), config_domains);

        // chart category
        const categoryData = result["ç±»å‹å æ¯”"];
        const category_labels = Object.keys(categoryData); // ç±»å‹
        const category_values = Object.values(categoryData); // è®¿é—®æ¬¡æ•°
        const config_category = {
            type: 'pie',
            data: {
                labels: category_labels,
                datasets: [{
                    label: 'å æ¯”',
                    data: category_values,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)',
                        'rgba(255, 99, 132, 0.2)',
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)',
                        'rgba(255, 99, 132, 1)',
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                animation: {
                    duration: 2000,
                    easing: 'easeOut',
                }
            },
            plugins: [{
                id: 'customLabels',
                afterDatasetsDraw(chart) {
                    const { ctx, chartArea: { width, height }, data } = chart;
                    chart.data.datasets[0].data.forEach((value, index) => {
                        const meta = chart.getDatasetMeta(0).data[index];
                        const { x, y } = meta.tooltipPosition();
                        ctx.save();
                        ctx.fillStyle = 'black';
                        ctx.font = '16px Arial';
                        ctx.textAlign = 'center';
                        if (value > 0.1) {
                            ctx.fillText(`${data.labels[index]}: ${(value * 100).toFixed(0)}%`, x, y);
                        }
                        ctx.restore();
                    });
                }
            }]
        }
        new Chart(document.getElementById('Chart_category'), config_category);

        // chart_hours
        const chart_colors = [
            'rgba(54, 162, 235, 0.8)', // è“è‰²
            'rgba(75, 192, 192, 0.8)', // é’ç»¿è‰²
            'rgba(153, 102, 255, 0.8)', // ç´«è‰²
            'rgba(255, 159, 64, 0.8)',  // æ©™è‰²
            'rgba(255, 99, 132, 0.8)',  // çº¢è‰²
            'rgba(201, 203, 207, 0.8)', // ç°è‰²
            'rgba(255, 205, 86, 0.8)',  // é»„è‰²
            'rgba(93, 173, 226, 0.8)',  // å¤©è“è‰²
            'rgba(46, 204, 113, 0.8)',  // ç»¿è‰²
            'rgba(231, 76, 60, 0.8)',   // æ·±çº¢è‰²
            'rgba(241, 196, 15, 0.8)',  // é‡‘è‰²
            'rgba(127, 140, 141, 0.8)'  // æ·±ç°è‰²
        ];
        const ctx_first = document.getElementById('Chart_first_half').getContext('2d');
        const data_first = {
            labels: [...Array(12).keys()],
            datasets: [{
                label: 'è®¿é—®åˆ†å¸ƒ',
                data: result["å‰åŠå¤©è®¿é—®é‡"],
                backgroundColor: chart_colors,
                Width: 1
            }]
        };
        const config_first = {
            type: 'polarArea',
            data: data_first,
        };
        new Chart(ctx_first, config_first);
        const ctx_second = document.getElementById('Chart_second_half').getContext('2d');
        const data_second = {
            labels: [...Array(12).keys()].map(i => i + 12),
            datasets: [{
                label: 'è®¿é—®åˆ†å¸ƒ',
                data: result["ååŠå¤©è®¿é—®é‡"],
                backgroundColor: chart_colors,
                Width: 1
            }]
        };
        const config_second = {
            type: 'polarArea',
            data: data_second,
        };
        new Chart(ctx_second, config_second);

        Reveal.on('slidechanged', (event) => {
            if (event.indexh === 1) {
                setTimeout(typeOverViewText, 500);
            } else if (event.indexh === 2) {
                const images = document.querySelectorAll('.animated-image');
                images.forEach(image => {
                    image.classList.add('animate-on-show');
                });
            }

            var existing_chart = Chart.getChart('Chart_domains');
            existing_chart.destroy();
            existing_chart = new Chart(document.getElementById('Chart_domains'), config_domains);

            existing_chart = Chart.getChart('Chart_category');
            existing_chart.destroy();
            existing_chart = new Chart(document.getElementById('Chart_category'), config_category);

            existing_chart = Chart.getChart('Chart_first_half');
            existing_chart.destroy();
            existing_chart = new Chart(document.getElementById('Chart_first_half'), config_first);
            existing_chart = Chart.getChart('Chart_second_half');
            existing_chart.destroy();
            existing_chart = new Chart(document.getElementById('Chart_second_half'), config_second);
        });
    </script>
</body>

</html>