<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="./static/css/base.css" rel="stylesheet">
    <link href="./static/css/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet"
        type="text/css">
    <title> {{ YEAR }} å¹´åº¦æ€»ç»“! </title>
    <style>
        .font-sans {
            font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
        }

        .font-serif {
            font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
        }

        .text-red-700 {
            color: #b91c1c;
        }

        .bg-yellow-200 {
            background-color: #fef08a;
        }

        .font-bold {
            font-weight: bold;
        }

        .px-1 {
            padding-left: 0.25rem;
            padding-right: 0.25rem;
        }

        #animated-text {
            max-height: 80vh;
            overflow-y: hidden;
            position: relative;
            scroll-behavior: smooth;
        }

        .animated-image {
            opacity: 0;
            transform: scale(0.5);
            transition: transform 1s ease-in-out, opacity 1s ease-in-out;
        }

        .animate-on-show {
            opacity: 1;
            transform: scale(1);
        }
    </style>

    <link rel="stylesheet" href="./static/reveal/reveal.css">
    <link rel="stylesheet" href="./static/reveal/theme/simple.css" id="theme">
    <link rel="stylesheet" href="./static/jyy/jyy.css">
    <style type="text/css">
        /* ç”¨æ¥æ§åˆ¶æ‰‡å½¢å›¾çš„ */
        #canvas-holder {
            background-color: #FFFFFF;
            height: 50%;
            width: 50%;
        }
    </style>
</head>

<body class="d-flex flex-column h-100">

    <div class="reveal">
        <div class="slides">
            <section>
                <div class="center middle">
                    <div style="width:100%">
                        <div>
                            <h2 id="_1" class="text-2xl mt-2 font-sans">ä½ çš„{{ YEAR }}å¹´æµè§ˆè®°å½•å¹´åº¦æ€»ç»“ğŸš€</h2>
                        </div>
                        <h5 id="_1" class="text-2xl mt-2 font-sans">
                            æŒ‰ä¸‹ â†’ <span class="text-blue-800">å¼€å§‹æ¢ç´¢å§ï¼</span>
                        </h5>
                    </div>
                </div>
            </section>
            <section>
                <audio id="typing-sound" src="./static/sound/keyboard-typing-5997.mp3" preload="auto"></audio>
                <h2 id="animated-text" class="text-2xl mt-2 font-sans"></h2>
            </section>
            <section>
                <div class="center middle">
                    <div style="width:100%">
                        <h2 class="text-2xl mt-2 font-sans">ä½ çš„å¹´åº¦å…³é”®è¯ç«Ÿæ˜¯ğŸ§</h2>
                        <center>
                            <img src="./wordcloud.png" alt="wordcloud" class="animated-image" />
                        </center>
                    </div>
                </div>
            </section>
            <section>
                <h2 class="text-2xl mt-2 font-sans">ä½ æœ€å¸¸è®¿é—®çš„åŸŸåğŸ”—</h2>
                <div style="width:100%">
                    <canvas id="Chart_domains"></canvas>
                </div>
            </section>
            <section>
                <h2 class="text-2xl mt-2 font-sans">â€œä¸å¤ªå‡†â€çš„ç±»å‹å æ¯”ğŸ“ˆ</h2>
                <div style="width:100%">
                    <center>
                        <div id="canvas-holder">
                            <canvas id="Chart_category"></canvas>
                        </div>
                    </center>
                </div>
            </section>
            <section>
                <h2 class="text-2xl mt-2 font-sans">ä½ çš„æ¯æœˆè®¿é—®é‡ğŸ“Š</h2>
                <div style="width:100%">
                    <canvas id="Chart_months"></canvas>
                </div>
            </section>
            <section>
                <h2 class="text-2xl mt-2 font-sans">ä½ çš„æ¯å‘¨è®¿é—®é‡ğŸ“Š</h2>
                <div style="width:100%">
                    <canvas id="Chart_weekdays"></canvas>
                </div>
            </section>
            <section>
                <h2 class="text-2xl mt-2 font-sans">ä½ æ›´çˆ±åœ¨è¿™äº›æ—¶é—´æ®µä¸Šç½‘ğŸ•’</h2>
                <div style="display: flex; justify-content: space-between;">
                    <div style="width: 45%; text-align: center;">
                        <canvas id="Chart_first_half"></canvas>
                    </div>
                    <div style="width: 48%; text-align: center;">
                        <canvas id="Chart_second_half"></canvas>
                    </div>
                </div>
            </section>
            <section>
                <div class="center middle">
                    <div style="width:100%; text-align: center;">
                        <p class="text-lg mt-4 font-sans">
                            å›é¡¾è¿™ä¸€å¹´ï¼Œæµè§ˆè®°å½•å‹¾å‹’å‡ºäº†ä½ æ¢ç´¢, æ‘¸é±¼, å­¦ä¹ ä¸æˆé•¿çš„è¶³è¿¹ã€‚
                        </p>
                        <p class="text-lg mt-4 font-sans">
                            å¸Œæœ›æ–°çš„ä¸€å¹´ï¼Œä½ å¯ä»¥ç»§ç»­å‹‡æ•¢è¿½æ¢¦ï¼Œæ¢ç´¢æ›´å¤šæœªçŸ¥çš„ä¸–ç•Œï¼ğŸ‰
                        </p>
                        <p class="text-lg mt-6 font-sans font-bold text-blue-700">
                            ğŸŒŸ ç¥æ„¿ä½ åœ¨æ–°çš„ä¸€å¹´ä¸‡äº‹èƒœæ„! ğŸŒŸ
                        </p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script src="./static/reveal/reveal.js"></script>
    <script src="./static/css/chart.js"></script>
    <script>
        const OVERVIEW_PAGE = 1;
        const WORD_CLOUD_PAGE = 2;
        const DOMAIN_PAGE = 3;
        const CATEGORY_PAGE = 4;
        const MONTH_PAGE = 5;
        const WEEK_PAGE = 6;
        const HOUR_PAGE = 7;
        const result = {{ OUTPUTJSON }};
        Reveal.initialize({
            width: 1024, height: 768,
            slideNumber: false,
            controlsTutorial: false,
            progress: false,
            hash: true,
            center: false,
            touch: true,
            autoAnimateUnmatched: true,
            autoAnimateEasing: 'ease-out',
            autoAnimateDuration: 1.0,
            transitionSpeed: 'default',
            transition: 'slide', // zoom
        });

        var rendered_page = new Set();
        Reveal.on('slidechanged', (event) => {
            if (rendered_page.has(event.indexh)) {
                return;
            }
            rendered_page.add(event.indexh);
            if (event.indexh != OVERVIEW_PAGE) {
                const typingSound = document.getElementById("typing-sound");
                typingSound.pause();
                typingSound.currentTime = 0;
            }

            switch (event.indexh) {
                case OVERVIEW_PAGE:
                    generate_overview();
                    break;
                case WORD_CLOUD_PAGE:
                    const images = document.querySelectorAll('.animated-image');
                    images.forEach(image => {
                        image.classList.add('animate-on-show');
                    });
                    break;
                case DOMAIN_PAGE:
                    generate_domain_chart(result);
                    break;
                case CATEGORY_PAGE:
                    generate_category_chart(result);
                    break;
                case MONTH_PAGE:
                    generate_month_chart(result);
                    break;
                case WEEK_PAGE:
                    generate_weekday_chart(result);
                    break;
                case HOUR_PAGE:
                    generate_hour_chart(result);
                    break;
                default:
                    break;
            }
        });

        function generate_overview() {
            const over_view_content = [
                { text: "åœ¨", highlight: false },
                { text: "{{ YEAR }}", highlight: true },
                { text: "å¹´, ä½ å…±è®¡æµè§ˆè¿‡", highlight: false },
                { text: "{{ DAYS }}", highlight: true },
                { text: "å¤©, ç‚¹å‡»äº†", highlight: false },
                { text: "{{ COUNT }}", highlight: true },
                { text: "æ¬¡é“¾æ¥, å¹³å‡æ¯å¤©ç‚¹å‡»", highlight: false },
                { text: "{{ AVG }}", highlight: true },
                { text: "æ¬¡.", highlight: false },
                { text: "\n\n", highlight: false },
                { text: "{{ LONGEST_DAY }}, ä½ ç«Ÿç„¶è®¿é—®äº†è¶³è¶³", highlight: false },
                { text: "{{ LONGEST_DAY_TIME }}", highlight: true },
                { text: "å°æ—¶, çœŸæ˜¯å¤ªå‰å®³äº†!", highlight: false },
                { text: "ä»", highlight: false },
                { text: "{{ HIGH_PEAK_HOUR }}", highlight: true },
                { text: "ç‚¹å¼€å§‹çš„ä¸€å°æ—¶, ä½ ç–¯ç‹‚æ•²å‡»äº† ", highlight: false },
                { text: "{{ HIGH_PEAK_COUNTS }}", highlight: true },
                { text: "æ¬¡é“¾æ¥, å˜´é‡Œèƒ¡è¨€ä¹±è¯­ç€", highlight: false },
                { text: "\"{{ HIGH_PEAK_TITLES }}\".", highlight: false },
                { text: "\n\n", highlight: false },
                { text: "{{ LATEST_SLEEP_DAY }}, ä½ åœ¨", highlight: false },
                { text: "{{ LATEST_SLEEP_TIME }}", highlight: true },
                { text: "è¿˜æœªå…¥çœ , é™ªä¼´ä½ çš„æ˜¯ \"{{ LATEST_SLEEP_TITLE }}\"\n", highlight: false },
                { text: "ä½ æœ€æ—©åœ¨ {{ EARLIEST_WAKE_DAY }}", highlight: false },
                { text: "{{ EARLIEST_WAKE_TIME }}", highlight: true },
                { text: "é†’æ¥, ç¬¬ä¸€ä¸ªè®¿é—®çš„ \"{{ EARLIEST_WAKE_TITLE }}\"", highlight: false },
            ];
            const container = document.getElementById("animated-text");
            const typingSound = document.getElementById("typing-sound"); // è·å–éŸ³é¢‘å…ƒç´ 
            typingSound.currentTime = 0; // é‡ç½®éŸ³é¢‘åˆ°å¼€å§‹ä½ç½®
            let index = 0;
            const allCharacters = over_view_content.flatMap(item =>
                item.text.split("").map(char => ({ char, highlight: item.highlight }))
            );
            function typeOverViewText() {
                if (index == 0) {
                    typingSound.play();
                }
                if (index < allCharacters.length) {
                    const span = document.createElement("span");
                    const text = allCharacters[index].char;
                    // æ£€æŸ¥æ˜¯å¦åŒ…å«æ¢è¡Œç¬¦
                    if (text === '\n') {
                        const br = document.createElement("br");
                        container.appendChild(br);  // æ¢è¡Œ
                    } else {
                        span.textContent = text;
                        if (allCharacters[index].highlight) {
                            span.className = "text-red-700 bg-yellow-200 font-bold px-1";
                        }
                        container.appendChild(span);
                    }
                    // åŠ¨æ€æ»šåŠ¨é€»è¾‘
                    if (container.scrollHeight > container.clientHeight) {
                        const scrooStep = 20 * window.innerHeight / 100;
                        container.scrollTop = container.scrollHeight - container.clientHeight + scrooStep;
                    }
                    index++;
                    setTimeout(typeOverViewText, 100);
                } else {
                    typingSound.pause();
                }
            }
            setTimeout(typeOverViewText, 500);
        }

        function generate_category_chart(result) {
            const categoryData = result["ç±»å‹å æ¯”"];
            const category_labels = Object.keys(categoryData); // ç±»å‹
            const category_values = Object.values(categoryData); // è®¿é—®æ¬¡æ•°
            const config_category = {
                type: 'pie',
                data: {
                    labels: category_labels,
                    datasets: [{
                        label: 'å æ¯”',
                        data: category_values,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)',
                            'rgba(255, 99, 132, 0.2)',
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(255, 99, 132, 1)',
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    animation: {
                        duration: 2000,
                        easing: 'easeOut',
                    }
                },
                plugins: [{
                    id: 'customLabels',
                    afterDatasetsDraw(chart) {
                        const { ctx, chartArea: { width, height }, data } = chart;
                        chart.data.datasets[0].data.forEach((value, index) => {
                            const meta = chart.getDatasetMeta(0).data[index];
                            const { x, y } = meta.tooltipPosition();
                            ctx.save();
                            ctx.fillStyle = 'black';
                            ctx.font = '16px Arial';
                            ctx.textAlign = 'center';
                            if (value > 0.1) {
                                ctx.fillText(`${data.labels[index]}: ${(value * 100).toFixed(0)}%`, x, y);
                            }
                            ctx.restore();
                        });
                    }
                }]
            }
            new Chart(document.getElementById('Chart_category'), config_category);
        }

        function generate_month_chart(result) {
            const months_data = result['æ¯æœˆè®¿é—®é‡'];
            const config_months = {
                type: 'line',
                data: {
                    labels: months_data['æœˆä»½'],
                    datasets: [{
                        data: months_data['è®¿é—®æ¬¡æ•°'],
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                    }]
                },
                options: {
                    animations: {
                        tension: {
                            duration: 1000,
                            easing: 'linear',
                            from: 1,
                            to: 0,
                            loop: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false // éšè—å›¾ä¾‹
                        },
                    }
                }
            };
            new Chart(document.getElementById('Chart_months'), config_months);
        }

        function generate_domain_chart(result) {
            const domainData = result["æœ€å¸¸è®¿é—®çš„åŸŸå"];
            const labels = Object.keys(domainData); // åŸŸå
            const values = Object.values(domainData); // è®¿é—®æ¬¡æ•°

            const data = {
                labels: labels,
                datasets: [{
                    label: 'è®¿é—®æ¬¡æ•°',
                    data: values,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            };

            const config_domains = {
                type: 'bar',
                data: data,
                options: {
                    indexAxis: 'y',
                    animation: {
                        duration: 1500, // åŠ¨ç”»æŒç»­æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰
                        easing: 'easeOutBounce', // åŠ¨ç”»ç¼“åŠ¨æ•ˆæœ
                        onComplete: () => {
                        }
                    },
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: true
                        }
                    },
                }
            };
            new Chart(document.getElementById('Chart_domains'), config_domains);
        }

        function generate_hour_chart(result) {
            const chart_colors = [
                'rgba(54, 162, 235, 0.8)', // è“è‰²
                'rgba(75, 192, 192, 0.8)', // é’ç»¿è‰²
                'rgba(153, 102, 255, 0.8)', // ç´«è‰²
                'rgba(255, 159, 64, 0.8)',  // æ©™è‰²
                'rgba(255, 99, 132, 0.8)',  // çº¢è‰²
                'rgba(201, 203, 207, 0.8)', // ç°è‰²
                'rgba(255, 205, 86, 0.8)',  // é»„è‰²
                'rgba(93, 173, 226, 0.8)',  // å¤©è“è‰²
                'rgba(46, 204, 113, 0.8)',  // ç»¿è‰²
                'rgba(231, 76, 60, 0.8)',   // æ·±çº¢è‰²
                'rgba(241, 196, 15, 0.8)',  // é‡‘è‰²
                'rgba(127, 140, 141, 0.8)'  // æ·±ç°è‰²
            ];
            const ctx_first = document.getElementById('Chart_first_half').getContext('2d');
            const data_first = {
                labels: [...Array(12).keys()],
                datasets: [{
                    label: 'è®¿é—®åˆ†å¸ƒ',
                    data: result["å‰åŠå¤©è®¿é—®é‡"],
                    backgroundColor: chart_colors,
                    Width: 1
                }]
            };
            const config_first = {
                type: 'polarArea',
                data: data_first,
            };
            new Chart(ctx_first, config_first);
            const ctx_second = document.getElementById('Chart_second_half').getContext('2d');
            const data_second = {
                labels: [...Array(12).keys()].map(i => i + 12),
                datasets: [{
                    label: 'è®¿é—®åˆ†å¸ƒ',
                    data: result["ååŠå¤©è®¿é—®é‡"],
                    backgroundColor: chart_colors,
                    Width: 1
                }]
            };
            const config_second = {
                type: 'polarArea',
                data: data_second,
            };
            new Chart(ctx_second, config_second);
        }

        function generate_weekday_chart(result) {
            const weekdayData = result["æ¯å‘¨è®¿é—®é‡"];
            const labels = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
            const config_weekdays = {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'è®¿é—®æ¬¡æ•°',
                        data: weekdayData,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: true
                        }
                    },
                }
            };
            new Chart(document.getElementById('Chart_weekdays'), config_weekdays);
        }
    </script>
</body>

</html>